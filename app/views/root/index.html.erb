<% if ProconBypassManHost.all.empty? %>
  <p>
    ProconBypassManHostの登録がありません。ProconBypassManHostを登録してください。
  </p>
<% end %>

<p>
キャプチャデバイス名: <input type=text><input type=button value='保存'><br>

<%= form_with(model: setting, local: true, html: { class: 'form-horizontal' }) do |form| %>
  <div class="field">
    <%= form.label :procon_bypass_man_host_id, '送信先PBM' %>
    <%= form.select :procon_bypass_man_host_id, ProconBypassManHost.all.collect { |host| [host.name, host.id] }, { prompt: 'Select a ProconBypassManHost' } %>
  </div>
  <div class="actions">
    <%= form.submit '保存' %>
  </div>
<% end %>

</p>

<%# TODO: selectboxを変更したら、保存ボタンを押さずに、即時保存をしてほしい %>
<!-- TODO: 処理中はcheckboxをロックする -->
<% CommandRule.all.each do |command_rule| %>
  <%= form_with(model: command_rule, local: true, html: { class: 'form-horizontal' }) do |form| %>
    <label for="<%= dom_id(command_rule) %>">
      <%= form.check_box :enabled, id: dom_id(command_rule) %>
      <%= command_rule.condition_name %>
    </label>
    <span style='margin-right: 5px; margin-left: 5px'>=></span> <%= form.select :procon_bypass_man_command_id, ProconBypassManCommand.all.collect { |cmd| [cmd.name, cmd.id] }, { prompt: 'Select a ProconBypassManCommand' } %>
    <%= form.submit '保存する' %>
  <% end %>
<% end %>

<p>
  <%= form_with(model: setting, local: true, html: { class: 'form-horizontal' }) do |form| %>
    <div class="field">
      <%= form.hidden_field :capture_enabled, value: !Setting.instance.capture_enabled %>
    </div>
    <div class="actions">
      <% if setting.capture_enabled %>
        <div class="submit-loader-wrapper">
          <div class='loader'></div>
          <%= form.submit '⏸️ 画面キャプチャと画像解析を停止する' %>
        </div>
      <% else %>
        <div class="submit-loader-wrapper">
          <div class='stopped-loader'></div>
          <%= form.submit '▶️ 画面キャプチャと画像解析を開始する' %>
        </div>
      <% end %>
    </div>
  <% end %>
</p>


<h3>動作確認</h3>

<ul>
  <li>PBMへ入力を行う</li>
  <ul>
    <li>
      <%= Procon::BUTTONS.map { |x| link_to(x, procon_bypass_man_remote_commands_path(buttons: [x]), class: 'button-like', data: { remote: true }, method: :post) }.join.html_safe %>
    </li>
  </ul>
  <li>画面キャプチャを行う</li>
</ul>
